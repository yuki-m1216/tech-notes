# ダッシュボード設計のベストプラクティス

効果的なダッシュボードを設計することで、システムの状態を一目で把握し、問題の早期発見と迅速な対応が可能になります。

## ダッシュボードの目的

### 誰のためのダッシュボードか

ダッシュボードは利用者によって求める情報が異なります。

| 利用者 | 目的 | 求める情報 |
|-------|------|-----------|
| **オンコールエンジニア** | インシデント対応 | エラー率、レスポンスタイム、直近の異常 |
| **開発チーム** | 日常的な健全性確認 | リソース使用率、エラー傾向、パフォーマンス |
| **マネジメント** | サービス全体の状況把握 | SLO達成状況、可用性、ビジネスメトリクス |

**設計時のポイント:**

- 一つのダッシュボードで全員のニーズを満たそうとしない
- 利用者ごとに専用のダッシュボードを用意する
- 階層構造（概要 → 詳細）を意識する

### 何のためのダッシュボードか

ダッシュボードの用途を明確にします。

| 用途 | 特徴 | 更新頻度 |
|-----|------|---------|
| **リアルタイム監視** | 現在の状態を即座に把握 | 1分以下 |
| **トレンド分析** | 長期的な傾向を把握 | 日次〜週次 |
| **キャパシティプランニング** | リソース計画の判断材料 | 月次 |
| **インシデント対応** | 問題発生時の調査用 | リアルタイム |

## メトリクスの選定基準

### ゴールデンシグナルを基本にする

[ゴールデンシグナル](multi-layer-monitoring.md#ゴールデンシグナルthe-four-golden-signals)を基本として、ダッシュボードに載せるメトリクスを選定します。詳細は[多層モニタリング](multi-layer-monitoring.md)を参照してください。

| シグナル | ダッシュボードでの表示例 |
|---------|------------------------|
| **レイテンシ** | レスポンスタイムのパーセンタイル推移グラフ |
| **トラフィック** | リクエスト数/秒の時系列グラフ |
| **エラー** | エラー率の推移、エラー種別の内訳 |
| **サチュレーション** | CPU/メモリ使用率のゲージ、キュー長 |

### 選定の判断基準

**載せるべきメトリクス:**

- エンドユーザー影響を示すもの（レスポンスタイム、エラー率）
- SLO/SLIに関連するもの
- 問題の予兆を示すもの（リソース使用率のトレンド）
- アクションにつながるもの

**載せるべきでないメトリクス:**

- 見ても何もアクションを起こせないもの
- 関連性の低い詳細データ
- 更新頻度が低すぎるもの
- 重複する情報

### レイヤー別のメトリクス例

| レイヤー | 推奨メトリクス |
|---------|---------------|
| **ユーザー体験** | Synthetics成功率、RUMパフォーマンス、Core Web Vitals |
| **アプリケーション** | APIエラー率、レスポンスタイム、スループット |
| **インフラ** | CPU/メモリ使用率、ディスクI/O、ネットワークトラフィック |

## レイアウトの考え方

### 重要度順の配置

**上部に配置するもの（最重要）:**

- サービス全体の健全性（緑/黄/赤のステータス）
- SLO達成状況
- 現在発生中のアラート

**中央に配置するもの:**

- ゴールデンシグナルの各メトリクス
- 主要コンポーネントの状態

**下部に配置するもの:**

- 詳細なリソースメトリクス
- 補足情報

### レイヤー別の配置

[多層モニタリング](multi-layer-monitoring.md)の考え方に沿って、レイヤーごとにセクションを分けます。

```
┌─────────────────────────────────────┐
│  サービス全体の健全性（ステータス）    │
├─────────────────────────────────────┤
│  ユーザー体験レイヤー                 │
│  - Synthetics / RUM                 │
├─────────────────────────────────────┤
│  アプリケーションレイヤー             │
│  - API Gateway / Lambda             │
├─────────────────────────────────────┤
│  インフラレイヤー                    │
│  - EC2 / RDS / ElastiCache          │
└─────────────────────────────────────┘
```

### 時間軸の統一

- 同じダッシュボード内では時間軸を統一する
- 比較が必要な場合は同じ期間で並べる
- 過去との比較（前週同時刻など）を含めると傾向が分かりやすい

## アンチパターン

### 1. 情報過多

**問題:**

- メトリクスを詰め込みすぎて、何が重要か分からない
- スクロールしないと全体が見えない
- グラフが小さすぎて読めない

**対策:**

- 1つのダッシュボードには7±2個のウィジェットを目安にする
- 詳細は別のダッシュボードにドリルダウンする構造にする
- 「このメトリクスを見て何をするか」を説明できないものは削除する

### 2. 更新されないダッシュボード

**問題:**

- 作成時のまま放置され、現在のシステム構成と乖離している
- 廃止されたサービスのメトリクスが残っている
- 誰も見なくなっている

**対策:**

- ダッシュボードのオーナーを明確にする
- 定期的なレビュー（月次/四半期）をスケジュールする
- 利用状況を確認し、見られていないダッシュボードは整理する

### 3. コンテキストの欠如

**問題:**

- 閾値やベースラインが分からない
- 何が「正常」なのか判断できない
- 問題発生時に参照すべき情報へのリンクがない

**対策:**

- グラフに閾値線を追加する
- 正常範囲を視覚的に示す
- ランブックやログへのリンクを含める
- ダッシュボードに説明テキストを追加する

### 4. 目的の不明確さ

**問題:**

- 「とりあえず作った」ダッシュボードで目的が曖昧
- 誰が見るのか決まっていない
- 見ても次のアクションにつながらない

**対策:**

- ダッシュボード作成時に目的と対象者を明確にする
- 名前に用途を含める（例: 「オンコール用_サービス概要」）
- 定期的な利用シーンを具体化する

## ダッシュボード運用のワークフロー

### 日常での活用

| タイミング | 確認するダッシュボード | 確認内容 |
|-----------|----------------------|---------|
| **朝会** | サービス概要 | 前日の異常、現在の健全性 |
| **週次レビュー** | トレンド分析用 | 週間の傾向、Warningの確認 |
| **月次レビュー** | キャパシティプランニング用 | リソース使用傾向、コスト |

Infoレベルのアラートをダッシュボードで確認するワークフローについては、[アラートレベルの決め方](alert-levels.md#infoレベルのダッシュボード活用)も参照してください。

### インシデント対応での活用

1. **概要ダッシュボード**で影響範囲を把握
2. **レイヤー別ダッシュボード**で問題箇所を特定
3. **詳細ダッシュボード**で根本原因を調査
4. 対応後、ダッシュボードで復旧を確認

## まとめ

- ダッシュボードは利用者と目的を明確にして設計する
- ゴールデンシグナルを基本にメトリクスを選定する
- 重要度順・レイヤー別にレイアウトを構成する
- 情報過多、更新放置、コンテキスト不足を避ける
- 定期的なレビューでダッシュボードを最新に保つ
- アクションにつながる情報に絞り込む

## 参考資料

- [Grafana Dashboard Best Practices](https://grafana.com/docs/grafana/latest/dashboards/build-dashboards/best-practices/) - ダッシュボードスプロールの防止、テンプレート変数の活用
- [Crafting an Actionable Observability Dashboard Experience（Chronosphere）](https://chronosphere.io/learn/observability-dashboard-experience/) - インシデント対応での活用、視覚的階層の設計
